{
  "version": 3,
  "sources": ["src/app/modules/expedition/modules/chatflow-reader/logics/context-changer.logic.ts"],
  "sourcesContent": ["import { inject } from \"@angular/core\";\nimport { HttpClient } from \"@angular/common/http\";\nimport { NodeLogicAbstract } from \"../classes/node-logic.abstract\";\nimport { ChatflowLogicContext } from \"../classes/chatflow-logic-context\";\nimport { ChatflowLogicContextManagerService } from \"../services/chatflow-logic-context-manager.service\";\n\nexport interface IContextChangerNode {\n  path: string;          // JSON íŒŒì¼ ê²½ë¡œ (ì˜ˆ: \"json/test\")\n  fileName: string;      // JSON íŒŒì¼ ì´ë¦„ (ì˜ˆ: \"test\")\n  returnContextName: string;  // ë˜ëŒì•„ê°ˆ ì»¨í…ìŠ¤íŠ¸ ì´ë¦„\n}\n\nexport class ContextChangerLogic extends NodeLogicAbstract<IContextChangerNode> {\n  private http = inject(HttpClient);\n  private contextManager = inject(ChatflowLogicContextManagerService);\n\n  start(): void {\n    const debugLogger = (window as any).debugLogger;\n    if (debugLogger) {\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', 'ğŸ”„ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½ ì‹œì‘');\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', `   ê²½ë¡œ: ${this.readData.data.path}`);\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', `   íŒŒì¼: ${this.readData.data.fileName}`);\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', `   ë³µê·€ ì»¨í…ìŠ¤íŠ¸: ${this.readData.data.returnContextName}`);\n    }\n\n    const fullPath = `./${this.readData.data.path}/${this.readData.data.fileName}.json`;\n    \n    if (debugLogger) {\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', `   ì „ì²´ ê²½ë¡œ: ${fullPath}`);\n    }\n\n    // JSON íŒŒì¼ ë¡œë“œ\n    this.http.get<any>(fullPath).subscribe({\n      next: (data) => {\n        if (debugLogger) {\n          debugLogger.success('ì±—í”Œë¡œìš°-ContextChanger', 'âœ… JSON íŒŒì¼ ë¡œë“œ ì„±ê³µ');\n        }\n\n        // ìƒˆë¡œìš´ ì»¨í…ìŠ¤íŠ¸ ìƒì„±\n        const newContextName = `${this.readData.data.fileName}_${Date.now()}`;\n        const newContext = new ChatflowLogicContext(\n          newContextName,\n          this.contextManager,\n          this.chatbotActionService\n        );\n\n        // ì»¨í…ìŠ¤íŠ¸ì— ë°ì´í„° ì„¤ì •\n        newContext.chatflowData = data.connected || data;\n\n        // ì»¨í…ìŠ¤íŠ¸ ë“±ë¡\n        this.contextManager.registerContext(newContextName, newContext);\n\n        // í˜„ì¬ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìŠ¤íƒì— ì €ì¥í•˜ê³  ìƒˆ ì»¨í…ìŠ¤íŠ¸ë¡œ ì „í™˜\n        this.contextManager.changeContext(newContext, true);\n\n        // ìƒˆ ì»¨í…ìŠ¤íŠ¸ì˜ ì¢…ë£Œ ì´ë²¤íŠ¸ êµ¬ë…\n        newContext.$chatflowEnded.subscribe(() => {\n          if (debugLogger) {\n            debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', 'ğŸ”™ ì„œë¸Œ ì±—í”Œë¡œìš° ì¢…ë£Œ, ì´ì „ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³µê·€');\n          }\n\n          // ì´ì „ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³µê·€\n          const returnContext = this.contextManager.getContext(this.readData.data.returnContextName);\n          \n          if (returnContext) {\n            this.contextManager.returnToPreviousContext();\n            \n            // í˜„ì¬ ë…¸ë“œì˜ ë‹¤ìŒ ë…¸ë“œë¡œ ì´ë™\n            this.end();\n          } else {\n            console.error(`ë³µê·€í•  ì»¨í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${this.readData.data.returnContextName}`);\n          }\n        });\n\n        // ìƒˆ ì±—í”Œë¡œìš° ì‹œì‘\n        newContext.start();\n      },\n      error: (error) => {\n        console.error('JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);\n        if (debugLogger) {\n          debugLogger.error('ì±—í”Œë¡œìš°-ContextChanger', `âŒ JSON íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`);\n        }\n        \n        // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ë‹¤ìŒ ë…¸ë“œë¡œ ì§„í–‰\n        this.end();\n      }\n    });\n  }\n\n  override end(): void {\n    const debugLogger = (window as any).debugLogger;\n    if (debugLogger) {\n      debugLogger.info('ì±—í”Œë¡œìš°-ContextChanger', 'âœ… ContextChanger ë…¸ë“œ ì¢…ë£Œ');\n    }\n    super.end();\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;AAYM,IAAO,sBAAP,cAAmC,kBAAsC;EACrE,OAAO,OAAO,UAAU;EACxB,iBAAiB,OAAO,kCAAkC;EAElE,QAAK;AACH,UAAM,cAAe,OAAe;AACpC,QAAI,aAAa;AACf,kBAAY,KAAK,2CAAuB,8DAAe;AACvD,kBAAY,KAAK,2CAAuB,oBAAU,KAAK,SAAS,KAAK,IAAI,EAAE;AAC3E,kBAAY,KAAK,2CAAuB,oBAAU,KAAK,SAAS,KAAK,QAAQ,EAAE;AAC/E,kBAAY,KAAK,2CAAuB,6CAAe,KAAK,SAAS,KAAK,iBAAiB,EAAE;IAC/F;AAEA,UAAM,WAAW,KAAK,KAAK,SAAS,KAAK,IAAI,IAAI,KAAK,SAAS,KAAK,QAAQ;AAE5E,QAAI,aAAa;AACf,kBAAY,KAAK,2CAAuB,iCAAa,QAAQ,EAAE;IACjE;AAGA,SAAK,KAAK,IAAS,QAAQ,EAAE,UAAU;MACrC,MAAM,CAAC,SAAQ;AACb,YAAI,aAAa;AACf,sBAAY,QAAQ,2CAAuB,oDAAiB;QAC9D;AAGA,cAAM,iBAAiB,GAAG,KAAK,SAAS,KAAK,QAAQ,IAAI,KAAK,IAAG,CAAE;AACnE,cAAM,aAAa,IAAI,qBACrB,gBACA,KAAK,gBACL,KAAK,oBAAoB;AAI3B,mBAAW,eAAe,KAAK,aAAa;AAG5C,aAAK,eAAe,gBAAgB,gBAAgB,UAAU;AAG9D,aAAK,eAAe,cAAc,YAAY,IAAI;AAGlD,mBAAW,eAAe,UAAU,MAAK;AACvC,cAAI,aAAa;AACf,wBAAY,KAAK,2CAAuB,wHAA4B;UACtE;AAGA,gBAAM,gBAAgB,KAAK,eAAe,WAAW,KAAK,SAAS,KAAK,iBAAiB;AAEzF,cAAI,eAAe;AACjB,iBAAK,eAAe,wBAAuB;AAG3C,iBAAK,IAAG;UACV,OAAO;AACL,oBAAQ,MAAM,mGAAwB,KAAK,SAAS,KAAK,iBAAiB,EAAE;UAC9E;QACF,CAAC;AAGD,mBAAW,MAAK;MAClB;MACA,OAAO,CAAC,UAAS;AACf,gBAAQ,MAAM,gDAAkB,KAAK;AACrC,YAAI,aAAa;AACf,sBAAY,MAAM,2CAAuB,uDAAoB,MAAM,OAAO,EAAE;QAC9E;AAGA,aAAK,IAAG;MACV;KACD;EACH;EAES,MAAG;AACV,UAAM,cAAe,OAAe;AACpC,QAAI,aAAa;AACf,kBAAY,KAAK,2CAAuB,iDAAwB;IAClE;AACA,UAAM,IAAG;EACX;;",
  "names": []
}

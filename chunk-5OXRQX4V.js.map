{
  "version": 3,
  "sources": ["src/app/modules/note/shared/components/drawing-canvas/drawing-canvas.component.ts"],
  "sourcesContent": ["import { Component, Input, Output, EventEmitter, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { IconComponent } from '../icon/icon.component';\n\n@Component({\n  selector: 'app-drawing-canvas',\n  standalone: true,\n  imports: [CommonModule, IconComponent],\n  template: `\n    <div class=\"flex flex-col h-full bg-white rounded-lg shadow-inner border border-gray-200\">\n      <!-- Toolbar -->\n      <div class=\"flex items-center justify-between p-3 border-b border-gray-100 bg-gray-50 rounded-t-lg\">\n        <div class=\"flex gap-2 items-center\">\n          <button \n            (click)=\"setColor('#000000')\" \n            [class.ring-2]=\"color === '#000000'\" \n            class=\"w-6 h-6 rounded-full bg-black ring-offset-2 ring-black\"\n          ></button>\n          <button \n            (click)=\"setColor('#2563eb')\" \n            [class.ring-2]=\"color === '#2563eb'\" \n            class=\"w-6 h-6 rounded-full bg-blue-600 ring-offset-2 ring-blue-600\"\n          ></button>\n          <button \n            (click)=\"setColor('#dc2626')\" \n            [class.ring-2]=\"color === '#dc2626'\" \n            class=\"w-6 h-6 rounded-full bg-red-600 ring-offset-2 ring-red-600\"\n          ></button>\n          <div class=\"w-px h-6 bg-gray-300 mx-2\"></div>\n          <button \n            (click)=\"setEraser()\" \n            [class.bg-gray-200]=\"isEraser\" \n            class=\"p-1.5 rounded-md hover:bg-gray-200 text-gray-600\" \n            title=\"지우개\"\n          >\n            <app-icon name=\"eraser\" [size]=\"20\"></app-icon>\n          </button>\n          <button \n            (click)=\"clearCanvas()\" \n            class=\"p-1.5 rounded-md hover:bg-gray-200 text-gray-600\" \n            title=\"전체 지우기\"\n          >\n            <app-icon name=\"trash-2\" [size]=\"20\"></app-icon>\n          </button>\n        </div>\n        <button \n          (click)=\"applyDrawing()\" \n          class=\"flex items-center gap-1 bg-blue-600 text-white px-4 py-1.5 rounded-md text-sm font-bold hover:bg-blue-700 transition-colors\"\n        >\n          <app-icon name=\"check\" [size]=\"16\"></app-icon>\n          완료\n        </button>\n      </div>\n      \n      <!-- Canvas -->\n      <div class=\"flex-1 relative overflow-hidden bg-white\">\n        <canvas \n          #canvas \n          class=\"absolute inset-0 w-full h-full cursor-crosshair touch-none\"\n          (mousedown)=\"startDrawing($event)\" \n          (mousemove)=\"draw($event)\" \n          (mouseup)=\"stopDrawing()\" \n          (mouseleave)=\"stopDrawing()\"\n          (touchstart)=\"startDrawingTouch($event)\"\n          (touchmove)=\"drawTouch($event)\"\n          (touchend)=\"stopDrawing()\"\n        ></canvas>\n      </div>\n    </div>\n  `\n})\nexport class DrawingCanvasComponent implements OnInit {\n  @ViewChild('canvas', { static: true }) canvasRef!: ElementRef<HTMLCanvasElement>;\n  @Input() initialData?: string;\n  @Output() apply = new EventEmitter<string | undefined>();\n\n  private ctx!: CanvasRenderingContext2D;\n  private isDrawing = false;\n  private lastX = 0;\n  private lastY = 0;\n\n  color = '#000000';\n  isEraser = false;\n\n  ngOnInit() {\n    this.initCanvas();\n    window.addEventListener('resize', () => this.resizeCanvas());\n  }\n\n  private initCanvas() {\n    const canvas = this.canvasRef.nativeElement;\n    this.ctx = canvas.getContext('2d')!;\n    this.resizeCanvas();\n\n    this.ctx.lineCap = 'round';\n    this.ctx.lineJoin = 'round';\n    this.ctx.lineWidth = 3;\n    this.ctx.strokeStyle = this.color;\n  }\n\n  private resizeCanvas() {\n    const canvas = this.canvasRef.nativeElement;\n    const parent = canvas.parentElement;\n    if (!parent) return;\n\n    // Save content\n    const tempCanvas = document.createElement('canvas');\n    const tempCtx = tempCanvas.getContext('2d')!;\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    tempCtx.drawImage(canvas, 0, 0);\n\n    // Resize\n    canvas.width = parent.clientWidth;\n    canvas.height = parent.clientHeight;\n\n    // Restore context settings\n    this.ctx.lineCap = 'round';\n    this.ctx.lineJoin = 'round';\n    this.ctx.lineWidth = this.isEraser ? 15 : 3;\n    this.ctx.strokeStyle = this.color;\n    if (this.isEraser) this.ctx.globalCompositeOperation = 'destination-out';\n\n    // Restore content\n    this.ctx.drawImage(tempCanvas, 0, 0);\n\n    // Load initial data if canvas is blank\n    if (this.initialData && this.isCanvasBlank(tempCanvas)) {\n      const img = new Image();\n      img.onload = () => this.ctx.drawImage(img, 0, 0);\n      img.src = this.initialData;\n    }\n  }\n\n  private isCanvasBlank(canvas: HTMLCanvasElement): boolean {\n    const blank = document.createElement('canvas');\n    blank.width = canvas.width;\n    blank.height = canvas.height;\n    return canvas.toDataURL() === blank.toDataURL();\n  }\n\n  setColor(newColor: string) {\n    this.color = newColor;\n    this.isEraser = false;\n    this.ctx.strokeStyle = this.color;\n    this.ctx.lineWidth = 3;\n    this.ctx.globalCompositeOperation = 'source-over';\n  }\n\n  setEraser() {\n    this.isEraser = true;\n    this.ctx.lineWidth = 15;\n    this.ctx.globalCompositeOperation = 'destination-out';\n  }\n\n  startDrawing(event: MouseEvent) {\n    this.isDrawing = true;\n    const { x, y } = this.getMouseCoordinates(event);\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  draw(event: MouseEvent) {\n    if (!this.isDrawing) return;\n    event.preventDefault();\n    const { x, y } = this.getMouseCoordinates(event);\n    this.drawLine(x, y);\n  }\n\n  startDrawingTouch(event: TouchEvent) {\n    event.preventDefault();\n    this.isDrawing = true;\n    const { x, y } = this.getTouchCoordinates(event);\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  drawTouch(event: TouchEvent) {\n    if (!this.isDrawing) return;\n    event.preventDefault();\n    const { x, y } = this.getTouchCoordinates(event);\n    this.drawLine(x, y);\n  }\n\n  private drawLine(x: number, y: number) {\n    this.ctx.beginPath();\n    this.ctx.moveTo(this.lastX, this.lastY);\n    this.ctx.lineTo(x, y);\n    this.ctx.stroke();\n    this.lastX = x;\n    this.lastY = y;\n  }\n\n  stopDrawing() {\n    this.isDrawing = false;\n    this.ctx.beginPath();\n  }\n\n  clearCanvas() {\n    const canvas = this.canvasRef.nativeElement;\n    this.ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  applyDrawing() {\n    const canvas = this.canvasRef.nativeElement;\n    const data = this.isCanvasBlank(canvas) ? undefined : canvas.toDataURL('image/png');\n    this.apply.emit(data);\n  }\n\n  getImageData(): string | undefined {\n    const canvas = this.canvasRef.nativeElement;\n    return this.isCanvasBlank(canvas) ? undefined : canvas.toDataURL('image/png');\n  }\n\n  private getMouseCoordinates(event: MouseEvent) {\n    const canvas = this.canvasRef.nativeElement;\n    const rect = canvas.getBoundingClientRect();\n    return {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top\n    };\n  }\n\n  private getTouchCoordinates(event: TouchEvent) {\n    const canvas = this.canvasRef.nativeElement;\n    const rect = canvas.getBoundingClientRect();\n    const touch = event.touches[0];\n    return {\n      x: touch.clientX - rect.left,\n      y: touch.clientY - rect.top\n    };\n  }\n}\n"],
  "mappings": "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",
  "names": []
}

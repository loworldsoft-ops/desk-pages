import{c as y}from"./chunk-ACZSRB5R.js";import{$b as C,Id as E,Rb as d,Sb as l,Tb as c,Ub as m,bb as o,bc as u,hc as f,ic as _,jc as b,ka as s,la as r,ob as g,pc as p,sc as D,xb as w}from"./chunk-UMLP25CN.js";var k=["canvas"],x=class v{canvasRef;initialData;apply=new w;ctx;isDrawing=!1;lastX=0;lastY=0;color="#000000";isEraser=!1;ngOnInit(){this.initCanvas(),window.addEventListener("resize",()=>this.resizeCanvas())}initCanvas(){let e=this.canvasRef.nativeElement;this.ctx=e.getContext("2d"),this.resizeCanvas(),this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=3,this.ctx.strokeStyle=this.color}resizeCanvas(){let e=this.canvasRef.nativeElement,n=e.parentElement;if(!n)return;let t=document.createElement("canvas"),i=t.getContext("2d");if(t.width=e.width,t.height=e.height,i.drawImage(e,0,0),e.width=n.clientWidth,e.height=n.clientHeight,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=this.isEraser?15:3,this.ctx.strokeStyle=this.color,this.isEraser&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(t,0,0),this.initialData&&this.isCanvasBlank(t)){let a=new Image;a.onload=()=>this.ctx.drawImage(a,0,0),a.src=this.initialData}}isCanvasBlank(e){let n=document.createElement("canvas");return n.width=e.width,n.height=e.height,e.toDataURL()===n.toDataURL()}setColor(e){this.color=e,this.isEraser=!1,this.ctx.strokeStyle=this.color,this.ctx.lineWidth=3,this.ctx.globalCompositeOperation="source-over"}setEraser(){this.isEraser=!0,this.ctx.lineWidth=15,this.ctx.globalCompositeOperation="destination-out"}startDrawing(e){this.isDrawing=!0;let{x:n,y:t}=this.getMouseCoordinates(e);this.lastX=n,this.lastY=t}draw(e){if(!this.isDrawing)return;e.preventDefault();let{x:n,y:t}=this.getMouseCoordinates(e);this.drawLine(n,t)}startDrawingTouch(e){e.preventDefault(),this.isDrawing=!0;let{x:n,y:t}=this.getTouchCoordinates(e);this.lastX=n,this.lastY=t}drawTouch(e){if(!this.isDrawing)return;e.preventDefault();let{x:n,y:t}=this.getTouchCoordinates(e);this.drawLine(n,t)}drawLine(e,n){this.ctx.beginPath(),this.ctx.moveTo(this.lastX,this.lastY),this.ctx.lineTo(e,n),this.ctx.stroke(),this.lastX=e,this.lastY=n}stopDrawing(){this.isDrawing=!1,this.ctx.beginPath()}clearCanvas(){let e=this.canvasRef.nativeElement;this.ctx.clearRect(0,0,e.width,e.height)}applyDrawing(){let e=this.canvasRef.nativeElement,n=this.isCanvasBlank(e)?void 0:e.toDataURL("image/png");this.apply.emit(n)}getImageData(){let e=this.canvasRef.nativeElement;return this.isCanvasBlank(e)?void 0:e.toDataURL("image/png")}getMouseCoordinates(e){let t=this.canvasRef.nativeElement.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}getTouchCoordinates(e){let t=this.canvasRef.nativeElement.getBoundingClientRect(),i=e.touches[0];return{x:i.clientX-t.left,y:i.clientY-t.top}}static \u0275fac=function(n){return new(n||v)};static \u0275cmp=g({type:v,selectors:[["app-drawing-canvas"]],viewQuery:function(n,t){if(n&1&&f(k,7),n&2){let i;_(i=b())&&(t.canvasRef=i.first)}},inputs:{initialData:"initialData"},outputs:{apply:"apply"},decls:17,vars:11,consts:[["canvas",""],[1,"flex","flex-col","h-full","bg-white","rounded-lg","shadow-inner","border","border-gray-200"],[1,"flex","items-center","justify-between","p-3","border-b","border-gray-100","bg-gray-50","rounded-t-lg"],[1,"flex","gap-2","items-center"],[1,"w-6","h-6","rounded-full","bg-black","ring-offset-2","ring-black",3,"click"],[1,"w-6","h-6","rounded-full","bg-blue-600","ring-offset-2","ring-blue-600",3,"click"],[1,"w-6","h-6","rounded-full","bg-red-600","ring-offset-2","ring-red-600",3,"click"],[1,"w-px","h-6","bg-gray-300","mx-2"],["title","\uC9C0\uC6B0\uAC1C",1,"p-1.5","rounded-md","hover:bg-gray-200","text-gray-600",3,"click"],["name","eraser",3,"size"],["title","\uC804\uCCB4 \uC9C0\uC6B0\uAE30",1,"p-1.5","rounded-md","hover:bg-gray-200","text-gray-600",3,"click"],["name","trash-2",3,"size"],[1,"flex","items-center","gap-1","bg-blue-600","text-white","px-4","py-1.5","rounded-md","text-sm","font-bold","hover:bg-blue-700","transition-colors",3,"click"],["name","check",3,"size"],[1,"flex-1","relative","overflow-hidden","bg-white"],[1,"absolute","inset-0","w-full","h-full","cursor-crosshair","touch-none",3,"mousedown","mousemove","mouseup","mouseleave","touchstart","touchmove","touchend"]],template:function(n,t){if(n&1){let i=C();l(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),u("click",function(){return s(i),r(t.setColor("#000000"))}),c(),l(4,"button",5),u("click",function(){return s(i),r(t.setColor("#2563eb"))}),c(),l(5,"button",6),u("click",function(){return s(i),r(t.setColor("#dc2626"))}),c(),m(6,"div",7),l(7,"button",8),u("click",function(){return s(i),r(t.setEraser())}),m(8,"app-icon",9),c(),l(9,"button",10),u("click",function(){return s(i),r(t.clearCanvas())}),m(10,"app-icon",11),c()(),l(11,"button",12),u("click",function(){return s(i),r(t.applyDrawing())}),m(12,"app-icon",13),D(13," \uC644\uB8CC "),c()(),l(14,"div",14)(15,"canvas",15,0),u("mousedown",function(h){return s(i),r(t.startDrawing(h))})("mousemove",function(h){return s(i),r(t.draw(h))})("mouseup",function(){return s(i),r(t.stopDrawing())})("mouseleave",function(){return s(i),r(t.stopDrawing())})("touchstart",function(h){return s(i),r(t.startDrawingTouch(h))})("touchmove",function(h){return s(i),r(t.drawTouch(h))})("touchend",function(){return s(i),r(t.stopDrawing())}),c()()()}n&2&&(o(3),p("ring-2",t.color==="#000000"),o(),p("ring-2",t.color==="#2563eb"),o(),p("ring-2",t.color==="#dc2626"),o(2),p("bg-gray-200",t.isEraser),o(),d("size",20),o(2),d("size",20),o(2),d("size",16))},dependencies:[E,y],encapsulation:2})};export{x as a};

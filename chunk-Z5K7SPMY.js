import{d as rt}from"./chunk-237UUUBJ.js";import{a as w}from"./chunk-GW37IABN.js";import{a as at}from"./chunk-CVVAG4KY.js";import{b as st,f as ut}from"./chunk-2ZGAM6Y2.js";import{d as ot}from"./chunk-HTTWL4JK.js";import{b as lt}from"./chunk-7ARLB4XQ.js";import{b as it}from"./chunk-TIV5CLLR.js";import{a as ct}from"./chunk-XQNGX6F7.js";import{d as nt}from"./chunk-FGNURVLG.js";import{a as y}from"./chunk-4DRAGH36.js";import{b as W}from"./chunk-RZOJEGTW.js";import{m as X}from"./chunk-QKZCIXE6.js";import{b as et}from"./chunk-UNIFLLIK.js";import{j as Z,q as tt}from"./chunk-I6L6EABA.js";import{h as Q}from"./chunk-P5T2C44A.js";import{qa as q,va as J,wa as $,xa as H}from"./chunk-MSA2X7VG.js";import{E as z,F as V}from"./chunk-ROH7LSZS.js";import{b as K,c as Y,d as a,g as h}from"./chunk-LZ4XSYEC.js";import{$a as k,Gb as S,Ib as O,Kb as P,Ob as D,Pa as b,Pb as U,Qb as N,Ta as l,Tc as B,Zb as u,_a as M,_b as F,ba as g,ca as f,eb as j,fa as m,fd as G,g as E,ja as C,ka as v,wb as _,xb as i,yb as r,zb as L}from"./chunk-5TLQJ6AI.js";var c=class n{constructor(e){this.router=e;this.initAuth()}STORAGE_KEY="chat_talk_auth";CREDENTIALS={username:w.decrypt(y.auth.username),password:w.decrypt(y.auth.password)};isAuthenticatedSubject=new E(this.checkAuthStatus());isAuthenticated$=this.isAuthenticatedSubject.asObservable();initAuth(){this.isAuthenticatedSubject.next(this.checkAuthStatus())}login(e,t){if(e===this.CREDENTIALS.username&&t===this.CREDENTIALS.password){let o=this.generateToken(e);return this.saveToken(o),this.isAuthenticatedSubject.next(!0),!0}return!1}logout(){console.log("[ChatTalkAuth] \uB85C\uADF8\uC544\uC6C3");try{localStorage.removeItem(this.STORAGE_KEY),sessionStorage.removeItem(this.STORAGE_KEY),this.isAuthenticatedSubject.next(!1)}catch(e){console.error("[ChatTalkAuth] \uB85C\uADF8\uC544\uC6C3 \uC911 \uC624\uB958:",e)}finally{this.router.navigate(["/chat-talk/login"]).catch(e=>{console.error("[ChatTalkAuth] \uB124\uBE44\uAC8C\uC774\uC158 \uC608\uC678 \uBC1C\uC0DD:",e),window.location.hash="#/chat-talk/login"})}}isAuthenticated(){return this.checkAuthStatus()}getCurrentUser(){let e=this.getToken();if(!e)return null;try{let t=JSON.parse(e);return new Date().getTime()-t.timestamp>1440*60*1e3?(this.logout(),null):{username:t.username}}catch{return this.logout(),null}}checkAuthStatus(){let e=this.getToken();if(!e)return!1;try{let t=JSON.parse(e);return new Date().getTime()-t.timestamp>1440*60*1e3?(this.logout(),!1):!0}catch{return!1}}generateToken(e){let t={username:e,timestamp:new Date().getTime()};return JSON.stringify(t)}saveToken(e){localStorage.setItem(this.STORAGE_KEY,e),sessionStorage.setItem(this.STORAGE_KEY,e)}getToken(){return localStorage.getItem(this.STORAGE_KEY)||sessionStorage.getItem(this.STORAGE_KEY)}static \u0275fac=function(t){return new(t||n)(m(a))};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};function dt(n,e){if(n&1){let t=S();i(0,"div",6)(1,"div",7)(2,"mat-icon"),u(3,"account_circle"),r(),i(4,"span"),u(5),r()(),i(6,"button",8),O("click",function(){C(t);let s=P();return v(s.onLogout())}),i(7,"mat-icon"),u(8,"logout"),r()()()}if(n&2){let t=P();b(5),F(t.currentUser.username)}}var x=class n{constructor(e,t){this.authService=e;this.router=t}currentUser=null;ngOnInit(){this.currentUser=this.authService.getCurrentUser()}onLogout(){this.authService.logout(),this.router.navigate(["/chat-talk/login"])}static \u0275fac=function(t){return new(t||n)(l(c),l(a))};static \u0275cmp=M({type:n,selectors:[["app-chat-talk"]],standalone:!1,decls:10,vars:1,consts:[[1,"chat-talk-container"],[1,"chat-talk-header"],[1,"header-left"],[1,"logo-icon"],["class","header-right",4,"ngIf"],[1,"chat-talk-content"],[1,"header-right"],[1,"user-info"],["mat-icon-button","","matTooltip","\uB85C\uADF8\uC544\uC6C3",3,"click"]],template:function(t,o){t&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-icon",3),u(4,"chat"),r(),i(5,"h1"),u(6,"\uCC44\uD305\uC0C1\uB2F4 \uC2DC\uC2A4\uD15C"),r()(),j(7,dt,9,1,"div",4),r(),i(8,"div",5),L(9,"router-outlet"),r()()),t&2&&(b(7),_("ngIf",o.currentUser))},dependencies:[B,Y,q,$,et],styles:["[_nghost-%COMP%]{display:block;height:100%;width:100%}.chat-talk-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;width:100%;background:#f5f7fa}.chat-talk-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 2px 8px #0000001a;z-index:10}.chat-talk-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.chat-talk-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .logo-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.chat-talk-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;padding:8px 16px;background:#fff3;border-radius:20px;font-size:14px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ffffff1a}.chat-talk-content[_ngcontent-%COMP%]{flex:1;overflow:hidden;display:flex;flex-direction:column}@media (max-width: 768px){.chat-talk-header[_ngcontent-%COMP%]{padding:12px 16px}.chat-talk-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:16px}.chat-talk-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .logo-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]{gap:8px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{padding:6px 12px;font-size:12px}.chat-talk-header[_ngcontent-%COMP%]   .header-right[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:none}}"]})};var gt=["loginComponent"],T=class n{constructor(e,t,o){this.authService=e;this.router=t;this.route=o}loginComponent;loginConfig={title:"\u{1F4AC} \uCC44\uD305\uD1A1",subtitle:"\uC5B8\uC81C \uC5B4\uB514\uC11C\uB098 \uC18C\uD1B5\uD558\uC138\uC694",moduleName:"chat-talk",showSocialLogin:!1,showRegisterLink:!1,themeColors:{primary:"#06b6d4",secondary:"#0891b2",accent:"#22d3ee"}};returnUrl="/chat-talk/client/home";ngOnInit(){if(this.authService.isAuthenticated()){this.router.navigate([this.returnUrl]);return}this.returnUrl=this.route.snapshot.queryParams.returnUrl||"/chat-talk/client/home"}onLogin(e){this.authService.login(e.username,e.password)?setTimeout(()=>{this.router.navigateByUrl(this.returnUrl).catch(()=>{this.router.navigate(["/chat-talk/client/home"])})},300):this.loginComponent&&this.loginComponent.setError("\uC544\uC774\uB514 \uB610\uB294 \uBE44\uBC00\uBC88\uD638\uAC00 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.")}static \u0275fac=function(t){return new(t||n)(l(c),l(a),l(K))};static \u0275cmp=M({type:n,selectors:[["app-chat-talk-login"]],viewQuery:function(t,o){if(t&1&&D(gt,5),t&2){let s;U(s=N())&&(o.loginComponent=s.first)}},standalone:!1,decls:2,vars:1,consts:[["loginComponent",""],[3,"loginSubmit","config"]],template:function(t,o){if(t&1){let s=S();i(0,"app-unified-login",1,0),O("loginSubmit",function(ht){return C(s),v(o.onLogin(ht))}),r()}t&2&&_("config",o.loginConfig)},dependencies:[at],encapsulation:2})};var d=class n{constructor(e,t){this.authService=e;this.router=t}canActivate(e,t){return this.authService.isAuthenticated()?!0:(this.router.navigate(["/chat-talk/login"],{queryParams:{returnUrl:t.url}}),!1)}static \u0275fac=function(t){return new(t||n)(m(c),m(a))};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};var ft=[{path:"login",component:T},{path:"",component:x,children:[{path:"client",loadChildren:()=>import("./chunk-BYTJGCXZ.js").then(n=>n.ChatTalkClientModule),canActivate:[d]},{path:"agent",loadChildren:()=>import("./chunk-VDYXEABV.js").then(n=>n.ChatTalkAgentModule),canActivate:[d]},{path:"",redirectTo:"agent",pathMatch:"full"}]},{path:"**",redirectTo:"login"}],A=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=k({type:n});static \u0275inj=f({imports:[h.forChild(ft),h]})};var mt=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=k({type:n});static \u0275inj=f({imports:[G,h,A,X,V,z,Z,tt,J,H,rt,ut,nt,ct,ot,st,lt,it,Q,W]})};export{mt as a};

import{a as he}from"./chunk-5O6JE4AX.js";import{c as ue}from"./chunk-ID5T2S5R.js";import{b as ge}from"./chunk-FVHCCNQG.js";import{a as de}from"./chunk-ZLC4EFIU.js";import{a as le,b as pe}from"./chunk-G3T635TF.js";import{d as me}from"./chunk-P6GORGWD.js";import{a as Ce}from"./chunk-UMB2PNP7.js";import"./chunk-6YJTCHRK.js";import{b as ce}from"./chunk-UFKCYXWI.js";import{j as ae,q as se}from"./chunk-A3I3ALLC.js";import{a as B,b as re}from"./chunk-UYFSIFAJ.js";import{sa as ie,va as oe}from"./chunk-43TLI6JO.js";import{b as T,d as R,g as P}from"./chunk-BOMXJJQJ.js";import"./chunk-IESNQYPT.js";import{E as te,F as ne,c as K,h as U,i as Z,k as J,m as X,n as ee}from"./chunk-GYV7E64H.js";import{$b as M,Ac as Y,Fd as G,Rb as m,Sb as o,Tb as r,Ub as b,W as v,Xa as q,ba as y,bb as s,bc as h,dc as p,f as w,hb as _,hc as L,ic as j,jc as $,ka as g,la as u,ob as k,pb as I,pc as H,qd as E,rd as S,sc as a,tc as x,ub as C,uc as O,yc as Q,zc as W}from"./chunk-KPABI5SC.js";import{a as z,b as V,h as f}from"./chunk-WWX6BADO.js";var be=["chatMessages"];function Oe(n,e){if(n&1){let t=M();o(0,"div",17)(1,"mat-icon",18),a(2,"error_outline"),r(),o(3,"h3"),a(4,"\uC5F0\uACB0 \uC2E4\uD328"),r(),o(5,"p"),a(6),r(),o(7,"button",19),h("click",function(){g(t);let c=p();return u(c.initNewChat())}),o(8,"mat-icon"),a(9,"refresh"),r(),a(10," \uB2E4\uC2DC \uC2DC\uB3C4 "),r()()}if(n&2){let t=p();s(6),x(t.connectionError)}}function Pe(n,e){if(n&1){let t=M();o(0,"div",20)(1,"div",21)(2,"mat-icon",22),a(3,"autorenew"),r()(),o(4,"h3"),a(5,"\uCC44\uD305 \uC5F0\uACB0 \uC911..."),r(),o(6,"p"),a(7,"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694"),r(),o(8,"button",23),h("click",function(){g(t);let c=p();return u(c.cancelConnection())}),o(9,"mat-icon"),a(10,"close"),r(),a(11," \uC5F0\uACB0 \uCDE8\uC18C "),r()()}}function we(n,e){n&1&&(o(0,"div",34)(1,"mat-icon"),a(2,"smart_toy"),r()())}function ye(n,e){if(n&1&&(o(0,"div",29),C(1,we,3,0,"div",30),o(2,"div",31),b(3,"div",32),o(4,"div",33),a(5),r()()()),n&2){let t=p().$implicit,i=p(2);s(),m("ngIf",t.senderType==="bot"),s(2),m("innerHTML",t.content,q),s(2),x(i.formatTime(t.createdAt))}}function ke(n,e){if(n&1&&(o(0,"div",29)(1,"div",31)(2,"div",35),a(3),r(),o(4,"div",33),a(5),r()()()),n&2){let t=p().$implicit,i=p(2);s(3),x(t.content),s(2),x(i.formatTime(t.createdAt))}}function Ie(n,e){if(n&1&&(o(0,"div",27),C(1,ye,6,3,"div",28)(2,ke,6,2,"div",28),r()),n&2){let t=e.$implicit;H("user-message",t.senderType==="client")("bot-message",t.senderType==="bot")("system-message",t.senderType==="system"),s(),m("ngIf",t.senderType!=="client"),s(),m("ngIf",t.senderType==="client")}}function Ee(n,e){n&1&&(o(0,"div",36)(1,"div",37),b(2,"span")(3,"span")(4,"span"),r()())}function Se(n,e){if(n&1&&(o(0,"div",24),C(1,Ie,3,8,"div",25)(2,Ee,5,0,"div",26),r()),n&2){let t=p();s(),m("ngForOf",t.messages),s(),m("ngIf",t.isLoading)}}function Te(n,e){if(n&1){let t=M();o(0,"button",40),h("click",function(){let c=g(t).$implicit,l=p(2);return u(l.selectQuickReply(c))}),a(1),r()}if(n&2){let t=e.$implicit;s(),O(" ",t," ")}}function Re(n,e){if(n&1&&(o(0,"div",38),C(1,Te,2,1,"button",39),r()),n&2){let t=p();s(),m("ngForOf",t.quickReplies)}}var D=class n{constructor(e,t,i,c,l){this.route=e;this.router=t;this.chatBotService=i;this.apiService=c;this.socketService=l}chatContainer;storeId="";storeName="";roomId=null;clientId=null;organizationId="1";isNewChat=!1;messages=[];newMessage="";welcomeMessage="";showQuickReplies=!0;quickReplies=[];isLoading=!1;isConnecting=!1;connectionError=null;currentTime=new Date;destroy$=new w;ngOnInit(){return f(this,null,function*(){this.route.queryParams.pipe(v(this.destroy$)).subscribe(e=>f(this,null,function*(){this.storeId=e.storeId||"",this.storeName=e.storeName||"\uC2A4\uD1A0\uC5B4",this.roomId=e.roomId||null,this.isNewChat=e.isNew==="true",this.isNewChat?yield this.initNewChat():this.roomId&&this.loadExistingChat()})),this.quickReplies=this.chatBotService.getQuickReplies(),yield this.connectWebSocket()})}ngAfterViewChecked(){this.scrollToBottom()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initNewChat(){return f(this,null,function*(){this.isConnecting=!0,this.connectionError=null;try{let t={fingerprintData:this.generateFingerprint(),pluginKey:this.organizationId},i=yield this.apiService.identifyCustomerWithObject(t).toPromise();if(!i||!i.client)throw new Error("\uACE0\uAC1D \uC2DD\uBCC4 API \uC751\uB2F5\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");this.clientId=i.client.id;let c={clientId:this.clientId,organizationId:this.organizationId},l=yield this.apiService.createRoomWithOrganization(c).toPromise();if(!l)throw new Error("\uCC44\uD305\uBC29 \uC0DD\uC131 API \uC751\uB2F5\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");this.roomId=l.id,this.welcomeMessage=`${this.storeName}\uC5D0 \uC624\uC2E0 \uAC83\uC744 \uD658\uC601\uD569\uB2C8\uB2E4! \uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?`,this.currentTime=new Date,this.showQuickReplies=!0;let d={id:"welcome",roomId:this.roomId||"",senderType:"bot",content:this.welcomeMessage,createdAt:new Date};this.messages=[d],yield this.joinRoom(),this.isConnecting=!1}catch(e){console.warn("\u274C \uC5D0\uB7EC \uC0C1\uC138:",{message:e.message,status:e.status,error:e.error,stack:e.stack}),this.connectionError="\uCC44\uD305\uC744 \uC2DC\uC791\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",e.status===404?this.connectionError="\uCC44\uD305 \uC11C\uBE44\uC2A4\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uAD00\uB9AC\uC790\uC5D0\uAC8C \uBB38\uC758\uD574\uC8FC\uC138\uC694.":e.status===500?this.connectionError="\uC11C\uBC84 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.":e.status===0?this.connectionError="\uC11C\uBC84\uC5D0 \uC5F0\uACB0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.":e.error?.message&&(this.connectionError=`\uC624\uB958: ${e.error.message}`),this.isConnecting=!1}})}generateFingerprint(){let e=window.navigator,t=window.screen;return{userAgent:e.userAgent,language:e.language,platform:e.platform,screen:`${t.width}x${t.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,canvas:this.generateCanvasFingerprint(),memory:e.deviceMemory||"unknown",cores:e.hardwareConcurrency||"unknown",cookieEnabled:e.cookieEnabled,doNotTrack:e.doNotTrack||"unspecified",timestamp:Date.now()}}generateCanvasFingerprint(){try{let e=document.createElement("canvas"),t=e.getContext("2d");return t?(e.width=200,e.height=50,t.textBaseline="top",t.font="14px Arial",t.fillText("Browser Fingerprint",10,10),e.toDataURL().substring(0,100)):"no-canvas"}catch{return"canvas-error"}}connectWebSocket(){return f(this,null,function*(){try{yield this.socketService.connect(),this.socketService.onEvent("newMessage").pipe(v(this.destroy$)).subscribe(e=>{e.roomId===this.roomId&&this.handleNewMessage(e.message)})}catch{}})}joinRoom(){return f(this,null,function*(){!this.roomId||!this.clientId||this.socketService.emitEvent("joinRoom",{roomId:this.roomId,clientId:this.clientId})})}handleNewMessage(e){let t=V(z({},e),{status:"sent"});this.messages.push(t)}loadExistingChat(){this.isLoading=!0,this.isLoading=!1}sendMessage(e){return f(this,null,function*(){e&&e.preventDefault();let t=this.newMessage.trim();if(!t||!this.roomId)return;let i={id:`temp-${Date.now()}`,roomId:this.roomId,senderType:"client",content:t,createdAt:new Date,status:"pending"};this.messages.push(i),this.newMessage="";try{this.socketService.emitEvent("sendMessage",{roomId:this.roomId,content:t,senderType:"client"}),i.status="sent",this.showQuickReplies&&(yield this.processBotResponse(t))}catch{i.status="failed"}})}processBotResponse(e){return f(this,null,function*(){setTimeout(()=>f(this,null,function*(){let t=yield this.chatBotService.processMessage(e),i={id:`bot-${Date.now()}`,roomId:this.roomId||"",senderType:"bot",content:t.message,createdAt:new Date};this.messages.push(i),t.action==="connectAgent"&&this.connectToAgent(),t.quickReplies&&(this.quickReplies=t.quickReplies)}),1e3)})}selectQuickReply(e){this.newMessage=e,this.sendMessage()}connectToAgent(){if(!this.roomId)return;this.socketService.emitEvent("requestSupport",{roomId:this.roomId}),this.showQuickReplies=!1;let e={id:`system-${Date.now()}`,roomId:this.roomId,senderType:"system",content:"\uC0C1\uB2F4\uC6D0\uC5D0\uAC8C \uC5F0\uACB0 \uC911\uC785\uB2C8\uB2E4. \uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694...",createdAt:new Date};this.messages.push(e)}goBack(){this.router.navigate(["/chat-talk/client/home"],{queryParams:{storeId:this.storeId}})}resetChat(){confirm("\uD604\uC7AC \uC0C1\uB2F4\uC744 \uC885\uB8CC\uD558\uACE0 \uC0C8\uB85C \uC2DC\uC791\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")&&(this.roomId&&this.socketService.emitEvent("leaveRoom",{roomId:this.roomId}),this.messages=[],this.roomId=null,this.clientId=null,this.showQuickReplies=!0,this.isConnecting=!1,this.connectionError=null,this.initNewChat())}cancelConnection(){this.isConnecting=!1,this.connectionError=null,this.goBack()}onInputChange(){let e=document.querySelector("textarea");e&&this.autoResizeTextarea(e)}onEnterPress(e){e.shiftKey||(e.preventDefault(),this.sendMessage())}autoResizeTextarea(e){e.style.height="auto",e.style.height=Math.min(e.scrollHeight,120)+"px"}scrollToBottom(){try{this.chatContainer&&(this.chatContainer.nativeElement.scrollTop=this.chatContainer.nativeElement.scrollHeight)}catch{}}formatTime(e){return new Date(e).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})}static \u0275fac=function(t){return new(t||n)(_(T),_(R),_(he),_(ue),_(Ce))};static \u0275cmp=k({type:n,selectors:[["app-chat-client"]],viewQuery:function(t,i){if(t&1&&L(be,5),t&2){let c;j(c=$())&&(i.chatContainer=c.first)}},standalone:!1,decls:28,vars:7,consts:[["chatMessages",""],[1,"chat-container"],[1,"chat-header"],[1,"back-btn",3,"click"],[1,"header-info"],[1,"status-text"],["matTooltip","\uC0C1\uB2F4 \uC0C8\uB85C \uC2DC\uC791",1,"menu-btn",3,"click"],[1,"messages-container"],["class","connection-error",4,"ngIf"],["class","connecting-state",4,"ngIf"],["class","messages-list",4,"ngIf"],["class","quick-replies",4,"ngIf"],[1,"input-container"],[1,"input-form",3,"submit"],["type","button","matTooltip","\uD30C\uC77C \uCCA8\uBD80",1,"attach-btn"],["name","message","placeholder","\uBA54\uC2DC\uC9C0\uB97C \uC785\uB825\uD558\uC138\uC694...","rows","1",1,"message-input",3,"ngModelChange","input","keydown.enter","ngModel"],["type","submit","matTooltip","\uC804\uC1A1",1,"send-btn",3,"disabled"],[1,"connection-error"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"],[1,"connecting-state"],[1,"spinner-wrapper"],[1,"spin"],["mat-raised-button","","color","warn",3,"click"],[1,"messages-list"],["class","message-wrapper",3,"user-message","bot-message","system-message",4,"ngFor","ngForOf"],["class","loading-message",4,"ngIf"],[1,"message-wrapper"],["class","message-bubble",4,"ngIf"],[1,"message-bubble"],["class","message-avatar",4,"ngIf"],[1,"message-content"],[1,"message-text",3,"innerHTML"],[1,"message-time"],[1,"message-avatar"],[1,"message-text"],[1,"loading-message"],[1,"typing-indicator"],[1,"quick-replies"],["class","quick-reply-btn",3,"click",4,"ngFor","ngForOf"],[1,"quick-reply-btn",3,"click"]],template:function(t,i){if(t&1){let c=M();o(0,"div",1)(1,"div",2)(2,"button",3),h("click",function(){return g(c),u(i.goBack())}),o(3,"mat-icon"),a(4,"arrow_back"),r()(),o(5,"div",4)(6,"h2"),a(7,"\uACE0\uAC1D \uC0C1\uB2F4"),r(),o(8,"p",5),a(9),r()(),o(10,"button",6),h("click",function(){return g(c),u(i.resetChat())}),o(11,"mat-icon"),a(12,"refresh"),r()()(),o(13,"div",7,0),C(15,Oe,11,1,"div",8)(16,Pe,12,0,"div",9)(17,Se,3,2,"div",10),r(),C(18,Re,2,1,"div",11),o(19,"div",12)(20,"form",13),h("submit",function(d){return g(c),u(i.sendMessage(d))}),o(21,"button",14)(22,"mat-icon"),a(23,"attach_file"),r()(),o(24,"textarea",15),Y("ngModelChange",function(d){return g(c),W(i.newMessage,d)||(i.newMessage=d),u(d)}),h("input",function(){return g(c),u(i.onInputChange())})("keydown.enter",function(d){return g(c),u(i.onEnterPress(d))}),r(),o(25,"button",16)(26,"mat-icon"),a(27,"send"),r()()()()()}t&2&&(s(9),O(" ",i.showQuickReplies?"\uCC57\uBD07 \uC751\uB2F5":"\uC0C1\uB2F4\uC6D0 \uC5F0\uACB0\uB428"," "),s(6),m("ngIf",i.connectionError),s(),m("ngIf",i.isConnecting&&!i.connectionError),s(),m("ngIf",!i.connectionError&&!i.isConnecting),s(),m("ngIf",i.showQuickReplies&&i.quickReplies.length>0),s(6),Q("ngModel",i.newMessage),s(),m("disabled",!i.newMessage.trim()))},dependencies:[E,S,ee,K,U,Z,X,J,ie,B,ce],styles:[".chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100vh;background:#f5f5f5}.chat-header[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 16px;background:#fff;border-bottom:1px solid #e0e0e0;box-shadow:0 2px 4px #0000000d}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:50%;transition:background .2s}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]:hover, .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]:hover{background:#f5f5f5}.chat-header[_ngcontent-%COMP%]   .back-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .chat-header[_ngcontent-%COMP%]   .menu-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#333}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]{flex:1;margin:0 12px}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:16px;font-weight:600;color:#333}.chat-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{margin:2px 0 0;font-size:12px;color:#667eea}.messages-container[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:16px}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:24px;text-align:center}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   .error-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#f44336;margin-bottom:16px}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-size:20px;font-weight:600}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 24px;color:#666;font-size:14px;max-width:300px;line-height:1.5}.messages-container[_ngcontent-%COMP%]   .connection-error[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:140px}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:24px;text-align:center}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   .spinner-wrapper[_ngcontent-%COMP%]{margin-bottom:16px}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   .spinner-wrapper[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;color:#667eea}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#333;font-size:18px;font-weight:600}.messages-container[_ngcontent-%COMP%]   .connecting-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.messages-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.message-wrapper[_ngcontent-%COMP%]{display:flex}.message-wrapper.user-message[_ngcontent-%COMP%]{justify-content:flex-end}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{flex-direction:row-reverse}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#667eea;color:#fff}.message-wrapper.user-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{color:#fffc}.message-wrapper.bot-message[_ngcontent-%COMP%], .message-wrapper.system-message[_ngcontent-%COMP%]{justify-content:flex-start}.message-wrapper.system-message[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#e3f2fd;color:#1976d2;font-size:14px;text-align:center}.message-bubble[_ngcontent-%COMP%]{display:flex;gap:8px;max-width:70%}.message-bubble[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#667eea;display:flex;align-items:center;justify-content:center;flex-shrink:0}.message-bubble[_ngcontent-%COMP%]   .message-avatar[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff;font-size:20px;width:20px;height:20px}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 1px 2px #0000001a}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-text[_ngcontent-%COMP%]{font-size:14px;line-height:1.5;white-space:pre-wrap;word-break:break-word}.message-bubble[_ngcontent-%COMP%]   .message-content[_ngcontent-%COMP%]   .message-time[_ngcontent-%COMP%]{font-size:11px;color:#999;margin-top:4px}.loading-message[_ngcontent-%COMP%]{display:flex;justify-content:flex-start}.typing-indicator[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:12px 16px;display:flex;gap:4px}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:8px;height:8px;background:#999;border-radius:50%;animation:_ngcontent-%COMP%_typing 1.4s infinite}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(2){animation-delay:.2s}.typing-indicator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(3){animation-delay:.4s}@keyframes _ngcontent-%COMP%_typing{0%,60%,to{transform:translateY(0);opacity:.7}30%{transform:translateY(-10px);opacity:1}}.quick-replies[_ngcontent-%COMP%]{padding:8px 16px;background:#fff;border-top:1px solid #e0e0e0;display:flex;gap:8px;overflow-x:auto;flex-wrap:wrap}.quick-replies[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.quick-replies[_ngcontent-%COMP%]   .quick-reply-btn[_ngcontent-%COMP%]{padding:8px 16px;background:#fff;border:1px solid #667eea;color:#667eea;border-radius:20px;font-size:13px;cursor:pointer;white-space:nowrap;transition:all .2s}.quick-replies[_ngcontent-%COMP%]   .quick-reply-btn[_ngcontent-%COMP%]:hover{background:#667eea;color:#fff}.input-container[_ngcontent-%COMP%]{background:#fff;border-top:1px solid #e0e0e0;padding:12px 16px}.input-form[_ngcontent-%COMP%]{display:flex;align-items:flex-end;gap:8px}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%], .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:50%;transition:background .2s;flex-shrink:0}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]:hover:not(:disabled), .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f5f5f5}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]:disabled, .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.input-form[_ngcontent-%COMP%]   .attach-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#667eea}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]{flex:1;border:1px solid #e0e0e0;border-radius:20px;padding:10px 16px;font-size:14px;font-family:inherit;resize:none;max-height:120px;outline:none}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]:focus{border-color:#667eea}.input-form[_ngcontent-%COMP%]   .message-input[_ngcontent-%COMP%]::placeholder{color:#999}.input-form[_ngcontent-%COMP%]   .send-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-45deg)}"]})};function Be(n,e){if(n&1&&(o(0,"span",17),a(1),r()),n&2){let t=p().$implicit;s(),O(" ",t.unreadCount," ")}}function De(n,e){if(n&1){let t=M();o(0,"div",10),h("click",function(){let c=g(t).$implicit,l=p(2);return u(l.openChatRoom(c))}),o(1,"div",11)(2,"mat-icon"),a(3,"chat_bubble"),r(),C(4,Be,2,1,"span",12),r(),o(5,"div",13)(6,"div",14),a(7),r(),o(8,"div",15),a(9),r()(),o(10,"mat-icon",16),a(11,"chevron_right"),r()()}if(n&2){let t=e.$implicit,i=p(2);s(4),m("ngIf",t.unreadCount&&t.unreadCount>0),s(3),x(i.getRoomStatusText(t.status)),s(2),x(i.formatTime(t.lastMessageAt))}}function Ae(n,e){if(n&1&&(o(0,"div",7)(1,"h2"),a(2,"\uC774\uC804 \uB300\uD654"),r(),o(3,"div",8),C(4,De,12,3,"div",9),r()()),n&2){let t=p();s(4),m("ngForOf",t.chatRooms)}}function Ne(n,e){n&1&&(o(0,"div",18),b(1,"mat-spinner",19),r())}function Fe(n,e){n&1&&(o(0,"div",20)(1,"mat-icon"),a(2,"chat_bubble_outline"),r(),o(3,"p"),a(4,"\uC544\uC9C1 \uB300\uD654 \uB0B4\uC5ED\uC774 \uC5C6\uC2B5\uB2C8\uB2E4"),r(),o(5,"p",21),a(6,"\uC0C8 \uBB38\uC758\uB97C \uC2DC\uC791\uD574\uBCF4\uC138\uC694!"),r()())}var A=class n{constructor(e,t){this.router=e;this.route=t}storeId="";chatRooms=[];isLoading=!1;destroy$=new w;ngOnInit(){this.route.queryParams.pipe(v(this.destroy$)).subscribe(e=>{this.storeId=e.storeId||"",this.storeId&&this.loadChatRooms()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadChatRooms(){this.isLoading=!0,this.chatRooms=[],this.isLoading=!1}startNewChat(){this.router.navigate(["/chat-talk/client/chat"],{queryParams:{storeId:this.storeId,isNew:!0}})}openChatRoom(e){this.router.navigate(["/chat-talk/client/chat"],{queryParams:{storeId:this.storeId,roomId:e.id}})}getRoomStatusText(e){return{bot_active:"\uCC57\uBD07 \uC751\uB2F5",waiting_agent:"\uC0C1\uB2F4\uC6D0 \uB300\uAE30\uC911",agent_active:"\uC0C1\uB2F4 \uC9C4\uD589\uC911",resolved:"\uC644\uB8CC",closed:"\uC885\uB8CC"}[e]||e}formatTime(e){if(!e)return"";let i=new Date().getTime()-new Date(e).getTime(),c=Math.floor(i/(1e3*60)),l=Math.floor(i/(1e3*60*60)),d=Math.floor(i/(1e3*60*60*24));return c<1?"\uBC29\uAE08 \uC804":c<60?`${c}\uBD84 \uC804`:l<24?`${l}\uC2DC\uAC04 \uC804`:d<7?`${d}\uC77C \uC804`:new Date(e).toLocaleDateString()}static \u0275fac=function(t){return new(t||n)(_(R),_(T))};static \u0275cmp=k({type:n,selectors:[["app-chat-client-home"]],standalone:!1,decls:17,vars:3,consts:[[1,"chat-home-container"],[1,"home-header"],[1,"home-content"],[1,"new-chat-btn",3,"click"],["class","chat-history",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"chat-history"],[1,"room-list"],["class","room-item",3,"click",4,"ngFor","ngForOf"],[1,"room-item",3,"click"],[1,"room-icon"],["class","unread-badge",4,"ngIf"],[1,"room-info"],[1,"room-status"],[1,"room-time"],[1,"arrow-icon"],[1,"unread-badge"],[1,"loading-container"],["diameter","40"],[1,"empty-state"],[1,"empty-sub"]],template:function(t,i){t&1&&(o(0,"div",0)(1,"div",1)(2,"h1")(3,"mat-icon"),a(4,"chat"),r(),a(5," \uACE0\uAC1D \uC0C1\uB2F4 "),r(),o(6,"p"),a(7,"\uBB34\uC5C7\uC744 \uB3C4\uC640\uB4DC\uB9B4\uAE4C\uC694?"),r()(),o(8,"div",2)(9,"button",3),h("click",function(){return i.startNewChat()}),o(10,"mat-icon"),a(11,"add_comment"),r(),o(12,"span"),a(13,"\uC0C8 \uBB38\uC758\uD558\uAE30"),r()(),C(14,Ae,5,1,"div",4)(15,Ne,2,0,"div",5)(16,Fe,7,0,"div",6),r()()),t&2&&(s(14),m("ngIf",i.chatRooms.length>0),s(),m("ngIf",i.isLoading),s(),m("ngIf",!i.isLoading&&i.chatRooms.length===0))},dependencies:[E,S,B,le],styles:[".chat-home-container[_ngcontent-%COMP%]{max-width:600px;margin:0 auto;padding:20px;height:100vh;display:flex;flex-direction:column}.home-header[_ngcontent-%COMP%]{text-align:center;padding:20px 0}.home-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px;font-size:24px;font-weight:600;margin:0 0 10px}.home-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px}.home-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin:0}.home-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.new-chat-btn[_ngcontent-%COMP%]{width:100%;padding:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:30px;transition:transform .2s,box-shadow .2s}.new-chat-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.new-chat-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 16px #0003}.new-chat-btn[_ngcontent-%COMP%]:active{transform:translateY(0)}.chat-history[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin:0 0 15px;color:#333}.room-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.room-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px;background:#fff;border:1px solid #e0e0e0;border-radius:8px;cursor:pointer;transition:all .2s}.room-item[_ngcontent-%COMP%]:hover{background:#f5f5f5;border-color:#667eea}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]{position:relative;margin-right:15px}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:32px;width:32px;height:32px;color:#667eea}.room-item[_ngcontent-%COMP%]   .room-icon[_ngcontent-%COMP%]   .unread-badge[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background:#f44;color:#fff;border-radius:10px;padding:2px 6px;font-size:11px;font-weight:600;min-width:18px;text-align:center}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]{flex:1}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]   .room-status[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#333;margin-bottom:4px}.room-item[_ngcontent-%COMP%]   .room-info[_ngcontent-%COMP%]   .room-time[_ngcontent-%COMP%]{font-size:12px;color:#999}.room-item[_ngcontent-%COMP%]   .arrow-icon[_ngcontent-%COMP%]{color:#ccc}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:40px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:#999}.empty-state[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;margin-bottom:20px;opacity:.3}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:10px 0;font-size:16px}.empty-state[_ngcontent-%COMP%]   .empty-sub[_ngcontent-%COMP%]{font-size:14px;color:#bbb}"]})};var ze=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:A},{path:"chat",component:D}],N=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=I({type:n});static \u0275inj=y({imports:[P.forChild(ze),P]})};var fe=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=I({type:n});static \u0275inj=y({imports:[G,P,N,te,ne,oe,re,ae,se,de,pe,me,ge]})};export{fe as ChatTalkClientModule};
